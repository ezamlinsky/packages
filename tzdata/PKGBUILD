################################################################################
# Encoding: UTF-8                                                  Tab size: 4 #
#                                                                              #
#                  ARCH LINUX PACKAGE BUILD DESCRIPTION FILE                   #
#                                                                              #
# Ordnung muss sein!                             Copyleft (Æ†) 2019, Arch Linux #
################################################################################
# Maintainer: Jack Black <ezamlinsky@gmail.com>

#==============================================================================#
#       Package information                                                    #
#==============================================================================#
pkgname=('tzdata')
pkgver=2019b
pkgrel=1
pkgdesc='Sources for time zone and daylight saving time data'
url='http://www.iana.org/time-zones'
license=('GPL')
arch=('any')

#==============================================================================#
#       Package dependencies                                                   #
#==============================================================================#
depends=('glibc')

#==============================================================================#
#       Package sources and integrity                                          #
#==============================================================================#
source=(
	"https://www.iana.org/time-zones/repository/releases/tzcode${pkgver}.tar.gz"
	"https://www.iana.org/time-zones/repository/releases/tzcode${pkgver}.tar.gz.asc"
	"https://www.iana.org/time-zones/repository/releases/tzdata${pkgver}.tar.gz"
	"https://www.iana.org/time-zones/repository/releases/tzdata${pkgver}.tar.gz.asc"
)
sha512sums=(
	'bcfb417fe3b7c39e702da0090291db0489744f733010ae183007fce5e441bfce885fb25ed11730cf7f363572e107d7ff0c4b38691bb99def2d8cf7017c05720f'
	'SKIP'
	'c0104078d994e501d80a41bea31364b1390a75c2fbf42968a8343a090e2ac2eddbc58770ca470b192ea19dec89fcc634141a1de703ea2ffa0325176a64afe1fc'
	'SKIP'
)

#==============================================================================#
#       Package preparation sequence                                           #
#==============================================================================#
prepare() {

	# Change directory to source directory
	cd $srcdir

	# Replace 'sbin' directory to 'bin'
	sed -i "s:sbin:bin:g" Makefile
}

#==============================================================================#
#       Package installation sequence                                          #
#==============================================================================#
package() {
	timezones=(
		'africa'
		'antarctica'
		'asia'
		'australasia'
		'backward'
		'etcetera'
		'europe'
		'factory'
		'northamerica'
		'pacificnew'
		'southamerica'
		'systemv'
	)

	# Change directory to source directory
	cd $srcdir

	# Install files
	make DESTDIR=$pkgdir install

	# Create required time zone files
	zic -y ./yearistype -d $pkgdir/usr/share/zoneinfo ${timezones[@]}
	zic -y ./yearistype -d $pkgdir/usr/share/zoneinfo/posix ${timezones[@]}
	zic -y ./yearistype -d $pkgdir/usr/share/zoneinfo/right -L leapseconds ${timezones[@]}
	zic -y ./yearistype -d $pkgdir/usr/share/zoneinfo -p America/New_York

	# Install country codes
	install -m444 -t $pkgdir/usr/share/zoneinfo iso3166.tab zone1970.tab zone.tab

	# Remove non required files
	rm -f $pkgdir/etc/localtime
}

################################################################################
#                                 END OF FILE                                  #
################################################################################
